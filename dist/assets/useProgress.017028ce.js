var ht=Object.defineProperty;var w=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var K=(t,e,r)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,D=(t,e)=>{for(var r in e||(e={}))Q.call(e,r)&&K(t,r,e[r]);if(w)for(var r of w(e))U.call(e,r)&&K(t,r,e[r]);return t};var X=(t,e)=>{var r={};for(var s in t)Q.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&w)for(var s of w(t))e.indexOf(s)<0&&U.call(t,s)&&(r[s]=t[s]);return r};import{V as I,r as n,u as b,aB as gt,o as vt,a5 as bt,aC as Y,P as tt,aD as Mt,aE as C}from"./index.0d8aed65.js";const y=new I,L=new I,yt=new I;function Pt(t,e,r){const s=y.setFromMatrixPosition(t.matrixWorld);s.project(e);const o=r.width/2,a=r.height/2;return[s.x*o+o,-(s.y*a)+a]}function $t(t,e){const r=y.setFromMatrixPosition(t.matrixWorld),s=L.setFromMatrixPosition(e.matrixWorld),o=r.sub(s),a=e.getWorldDirection(yt);return o.angleTo(a)>Math.PI/2}function Wt(t,e,r,s){const o=y.setFromMatrixPosition(t.matrixWorld),a=o.clone();a.project(e),r.setFromCamera(a,e);const p=r.intersectObjects(s,!0);if(p.length){const h=p[0].distance;return o.distanceTo(r.ray.origin)<h}return!0}function jt(t,e){if(e instanceof Y)return e.zoom;if(e instanceof tt){const r=y.setFromMatrixPosition(t.matrixWorld),s=L.setFromMatrixPosition(e.matrixWorld),o=e.fov*Math.PI/180,a=r.distanceTo(s),p=2*Math.tan(o/2)*a;return 1/p}else return 1}function wt(t,e,r){if(e instanceof tt||e instanceof Y){const s=y.setFromMatrixPosition(t.matrixWorld),o=L.setFromMatrixPosition(e.matrixWorld),a=s.distanceTo(o),p=(r[1]-r[0])/(e.far-e.near),h=r[1]-p*e.far;return Math.round(p*a+h)}}const H=t=>Math.abs(t)<1e-10?0:t;function et(t,e,r=""){let s="matrix3d(";for(let o=0;o!==16;o++)s+=H(e[o]*t.elements[o])+(o!==15?",":")");return r+s}const Ct=(t=>e=>et(e,t))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Et=(t=>(e,r)=>et(e,t(r),"translate(-50%,-50%)"))(t=>[1/t,1/t,1/t,1,-1/t,-1/t,-1/t,-1,1/t,1/t,1/t,1,1,1,1,1]),Ot=n.exports.forwardRef((St,N)=>{var Z=St,{children:t,eps:e=.001,style:r,className:s,prepend:o,center:a,fullscreen:p,portal:h,distanceFactor:P,sprite:rt=!1,transform:d=!1,occlude:$,onOcclude:V,zIndexRange:st=[16777271,0],calculatePosition:B=Pt,as:ot="div",wrapperClass:E,pointerEvents:A="auto"}=Z,nt=X(Z,["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","onOcclude","zIndexRange","calculatePosition","as","wrapperClass","pointerEvents"]);var S;const it=b(({gl:i})=>i),l=b(({camera:i})=>i),z=b(({scene:i})=>i),u=b(({size:i})=>i),at=b(({raycaster:i})=>i),[c]=n.exports.useState(()=>document.createElement(ot)),F=n.exports.useMemo(()=>gt(c),[c]),f=n.exports.useRef(null),_=n.exports.useRef(0),W=n.exports.useRef([0,0]),T=n.exports.useRef(null),O=n.exports.useRef(null),g=(S=h==null?void 0:h.current)!==null&&S!==void 0?S:it.domElement.parentNode;n.exports.useEffect(()=>{if(f.current){if(z.updateMatrixWorld(),d)c.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const i=B(f.current,l,u);c.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${i[0]}px,${i[1]}px,0);transform-origin:0 0;`}return g&&(o?g.prepend(c):g.appendChild(c)),()=>{g&&g.removeChild(c),F.unmount()}}},[g,d]),n.exports.useLayoutEffect(()=>{E&&(c.className=E)},[E]);const k=n.exports.useMemo(()=>d?{position:"absolute",top:0,left:0,width:u.width,height:u.height,transformStyle:"preserve-3d",pointerEvents:"none"}:D(D({position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none"},p&&{top:-u.height/2,left:-u.width/2,width:u.width,height:u.height}),r),[r,a,p,u,d]),ct=n.exports.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);n.exports.useLayoutEffect(()=>{d?F.render(n.exports.createElement("div",{ref:T,style:k},n.exports.createElement("div",{ref:O,style:ct},n.exports.createElement("div",{ref:N,className:s,style:r,children:t})))):F.render(n.exports.createElement("div",{ref:N,style:k,className:s,children:t}))});const v=n.exports.useRef(!0);return vt(()=>{if(f.current){l.updateMatrixWorld(),f.current.updateWorldMatrix(!0,!1);const i=d?W.current:B(f.current,l,u);if(d||Math.abs(_.current-l.zoom)>e||Math.abs(W.current[0]-i[0])>e||Math.abs(W.current[1]-i[1])>e){const q=$t(f.current,l);let j=!1;typeof $=="boolean"?$===!0&&(j=[z]):Array.isArray($)&&(j=$.map(x=>x.current));const lt=v.current;if(j){const x=Wt(f.current,l,at,j);v.current=x&&!q}else v.current=!q;if(lt!==v.current&&(V?V(!v.current):c.style.display=v.current?"block":"none"),c.style.zIndex=`${wt(f.current,l,st)}`,d){const[x,G]=[u.width/2,u.height/2],R=l.projectionMatrix.elements[5]*G,{isOrthographicCamera:J,top:ut,left:ft,bottom:pt,right:dt}=l,xt=Ct(l.matrixWorldInverse),mt=J?`scale(${R})translate(${H(-(dt+ft)/2)}px,${H((ut+pt)/2)}px)`:`translateZ(${R}px)`;let m=f.current.matrixWorld;rt&&(m=l.matrixWorldInverse.clone().transpose().copyPosition(m).scale(f.current.scale),m.elements[3]=m.elements[7]=m.elements[11]=0,m.elements[15]=1),c.style.width=u.width+"px",c.style.height=u.height+"px",c.style.perspective=J?"":`${R}px`,T.current&&O.current&&(T.current.style.transform=`${mt}${xt}translate(${x}px,${G}px)`,O.current.style.transform=Et(m,1/((P||10)/400)))}else{const x=P===void 0?1:jt(f.current,l)*P;c.style.transform=`translate3d(${i[0]}px,${i[1]}px,0) scale(${x})`}W.current=i,_.current=l.zoom}}}),n.exports.createElement("group",bt({},nt,{ref:f}))});let M=0;const Rt=Mt(t=>(C.onStart=(e,r,s)=>{t({active:!0,item:e,loaded:r,total:s,progress:(r-M)/(s-M)*100})},C.onLoad=()=>{t({active:!1})},C.onError=e=>t(r=>({errors:[...r.errors,e]})),C.onProgress=(e,r,s)=>{r===s&&(M=s),t({active:!0,item:e,loaded:r,total:s,progress:(r-M)/(s-M)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));export{Ot as H,Rt as u};
